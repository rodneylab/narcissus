---
const { content } = Astro.props;
import Layout from './index.jsx';
import PostViewsLikes from '../PostViewsLikes.jsx';
import website from '../../configuration/website.js';
import Comments from '../Comments.jsx';
import CommentForm from '../CommentForm.jsx';


const { workerUrl} = website;

const {featuredImage, postTitle, seoMetaDescription} = content;
const slug = featuredImage.split('.')[0];

const response = await fetch(`${workerUrl}/post/data`, {
  method: 'POST',
  credentials: 'omit',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ slug}),
});
const data = await response.json();
const {comments, likes, views} = data;
---

<html>
  <head>
    <title>{postTitle}</title>
  </head>

  <body>
	   <Layout:load slug={slug}>
		 <h1>{postTitle}</h1>
     <PostViewsLikes likes={likes} views={views} slug={slug} comments={comments.length}/>
    <slot />
     <PostViewsLikes likes={likes} views={views} slug={slug} comments={comments.length}/>
    <CommentForm slug={slug}/>
    <Comments comments={comments}/>
		</Layout:load>
  </body>
</html>
